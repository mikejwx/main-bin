execfile('/home/xb899100/bin/projectFun.py')
execfile('/home/xb899100/bin/SkewT.py')
execfile('/home/xb899100/bin/soundingRaw.py')
P = np.arange(1015., 95., -5.)
#P_obs = np.array([1013,1000,982.4,953,948.8,939,925,916,883.9,852,850,843,822.8,793.6,783,765.4,754,745,737.9,700,660.1,634,613,612.3,593,567.3,553,511,500,485.6,465,451,411,400,397.3,357,354,352,350.9,349,339,327,322.3,313,300,293,273,261,258.4,256,250,249,235.8,231,200,188,185.7,167,165,159.7,153,150,140,130.2,130,123.8,116,111.8,106.3,100,96.1,91.4,87,82.8,78.8,73.5,71.3,70,68.6,67.9,64.7,61.6,58.7,53.2,52,50,46.9,46,43.8,42.3,40.9,37.7])
interpolated = get_interpolated_soundings(P)
soundings = get_raw_soundings()

my_date = np.where(interpolated['date'] == 2014061112)[1][0]
P = soundings['pres'][:, my_date]*1.
i0 = np.where(P == 0)[0][0]
P = P[:i0]

#T = interpolated['temp'][:, my_date]*1.
T = soundings['temp'][:i0, my_date]*1.
#T -= 273.15
#T_obs = np.array([26.4,24.8,23.4,21,20.6,19.6,19.8,19.3,17.6,15.8,15.8,15.6,14.4,12.7,12,11,10.4,9.6,9.2,6.8,4,2,0.6,0.5,-1.1,-2.5,-3.3,-7.1,-7.9,-9.2,-11.1,-12.5,-17.9,-18.9,-19.3,-24.9,-25.3,-25.7,-25.9,-26.3,-28.3,-29.9,-30.6,-32.1,-34.7,-36.1,-39.9,-42.7,-43.2,-43.7,-45.3,-45.3,-48.4,-49.5,-58.1,-61.5,-62.2,-67.7,-68.1,-68,-67.9,-68.7,-70.3,-67.4,-67.3,-68.2,-69.3,-68.5,-67.5,-66.3,-65.9,-65.4,-64.8,-64.3,-63.8,-63.1,-61.5,-60.5,-59.9,-59.9,-59.6,-59.4,-59.2,-58.8,-58.7,-59.9,-60.7,-60,-58.2,-56.9,-57.7,-59.2])
#T = interpolateP(T_obs, P, P_obs)

#Td = interpolated['temp_d'][:, my_date]*1.
Td = soundings['temp_d'][:i0, my_date]*1.
#Td -= 273.15
#Td_obs = np.array([23.5,22.9,22.2,21,20.3,18.6,16,15.1,12,8.8,8.8,6.6,6.7,6.9,7,3.6,1.4,5.6,5.3,3.4,1.3,-0.1,-4.4,-4.3,-2.8,-6.9,-9.3,-8.6,-10.9,-12.6,-15.2,-17.5,-18.5,-20.7,-21.1,-27.1,-32.3,-28.9,-30.1,-32.3,-29.2,-34.9,-36,-38.1,-38.9,-39.9,-46.9,-47.1,-50.5,-53.7,-52.3,-51.3,-60.2,-63.5,-68.1,-65.4,-66,-70.9,-72.3,-73.4,-74.9,-74.7,-76.3,-80.2,-80.3,-81.6,-83.3,-84.5,-86.2,-88.3,-88.5,-88.8,-89.1,-89.4,-89.7,-90.1,-89.7,-89.5,-89.9,-89.9,-89.9,-89.8,-89.8,-89.7,-89.7,-89.9,-90.7,-90.5,-90.2,-89.9,-88.7,-88.4])
#Td = interpolateP(Td_obs, P, P_obs)

#U = interpolated['uwind'][:, my_date]*1.
U = soundings['uwind'][:i0, my_date]*1.
#U_obs = np.array([7.573218951,8.002186021,9.851331539,11.4583439,11.65511814,13.25821551,15.46809229,15.46809229,15.46809229,14.90616735,14.90616735,14.83419049,14.50133652,14.01795864,13.83135787,13.98614177,13.51993704,13.51993704,13.05373232,12.58752759,14.50133652,13.25821551,12.58752759,12.58752759,13.4465456,14.40929511,13.91242286,13.41555062,12.91867837,13.91242286,12.91867837,12.42180613,10.93118939,10.43431715,11.42806164,13.27470925,13.75363515,13.71780582,13.67779792,13.71780582,13.36625268,12.76414351,12.6646277,12.57897815,12.42180613,12.42180613,11.92493388,11.92493388,11.92493388,11.57265989,11.27373616,11.27373616,14.4032,14.40100632,15.88571913,14.73393959,14.69096814,16.93384927,17.39379014,17.73047879,15.19755324,14.18438303,12.6646277,15.37327658,15.37327658,12.56782499,11.30990611,9.937444901,9.667557683,6.585606406,6.585606406,8.21742403,8.199080843,6.236768548,11.78617871,6.039769962,3.637357282,5.056461739,4.635089927,4.213718116,7.092191514,4.454834677,-3.306499464,4.833778841,3.815546998,-0.179331656,0.080764848,0.134498742,0,-0.385395263,-1.403279826,-4.611982974])
#U = interpolateP(U_obs, P, P_obs)

#V = interpolated['vwind'][:, my_date]*1.
V = soundings['vwind'][:i0, my_date]*1.
#V_obs = np.array([3.786609476,5.6584,6.332313852,5.201979274,4.925665769,5.180397506,5.290399143,5.290399143,5.290399143,3.858,3.858,4.088857043,4.959749196,4.794424223,5.181317854,5.910798923,5.713772292,5.713772292,5.516745662,5.319719031,4.959749196,5.180397506,5.319719031,5.319719031,4.818810975,3.7294,3.6008,3.4722,3.3436,3.6008,3.3436,3.215,2.8292,2.7006,2.9578,-1.6177801,-1.914136054,-2.145937616,-2.375124683,-2.145937616,-0.466475491,1.555557789,2.199189522,2.615316615,3.215,3.215,3.0864,3.0864,3.0864,2.406091286,0.982570849,0.982570849,2.64691E-15,0.251332215,1.38453165,2.304895958,2.551059845,-1.181245612,-1.818146154,-3.07886533,-2.639027426,-2.463092264,-2.199189522,-1.339869339,-1.339869339,-4.298449303,0.394710031,2.572,-3.306499464,-1.143578551,-1.143578551,-2.810524545,-0.714596981,3.118384274,-1.02723316,-3.289494484,-2.572,2.900267305,2.658578363,2.416889421,-1.231546132,-2.227417339,-2.532925541,1.653249732,-1.429329063,0.178649245,-0.080654162,-0.133986934,0,0.357332266,1.026293895,-0.401960802])
#V = interpolateP(V_obs, P, P_obs)

#RH_obs = np.array([84,89,93,100,98,94,79,77,70,63,63,55,60,68,71,60,54,76,77,79,83,86,69,70,88,72,63,89,79,76,72,66,95,86,85,82,52,74,68,57,92,62,60,55,66,68,47,62,45,32,45,51,24,18,27,60,60,64,55,46,36,42,41,15,14,13,12,8,5,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1])
#RH = interpolateP(RH_obs, P, P_obs)
RH = soundings['RH'][:i0, my_date]*1.

#Q1 = getQ(T, RH, P)
#Q_obs = np.array([18.38,17.94,17.49,16.73,16.06,14.58,12.51,11.95,10.08,8.41,8.43,7.3,7.55,7.94,8.09,6.53,5.65,7.71,7.6,7.03,6.42,6.03,4.53,4.55,5.28,4.03,3.44,3.93,3.35,3,2.54,2.16,2.18,1.85,1.8,1.17,0.72,1,0.89,0.73,1.01,0.61,0.55,0.46,0.44,0.41,0.21,0.21,0.15,0.1,0.12,0.14,0.05,0.03,0.02,0.03,0.03,0.02,0.01,0.01,0.01,0.01,0.01,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])/1000.
#Q = interpolateP(Q_obs, P, P_obs)
#Q = interpolated['q'][:, my_date]*1.
Q = soundings['q'][:i0, my_date]*1.
myQ = myQfromRH(T+273.15, RH, P)
#Tp0 = T[0]
#Td1 = getDew(Q, P)

#Z = interpolated['height'][:, my_date]*1.
Z = soundings['height'][:i0, my_date]
if Z[0] != 37:
    diff = 37 - Z[0]
    Z += diff
#Z_obs = np.array([37,149,305,571,610,700,830,914,1219,1534,1554,1624,1829,2134,2248,2438,2563,2663,2743,3179,3658,3987,4258,4267,4524,4877,5079,5700,5870,6096,6431,6665,7367,7570,7620,8409,8470,8511,8534,8573,8783,9041,9144,9352,9650,9814,10298,10602,10668,10732,10890,10917,11278,11413,12340,12726,12802,13447,13519,13716,13972,14090,14501,14935,14945,15240,15628,15850,16154,16520,16764,17069,17374,17678,17983,18407,18593,18710,18836,18898,19202,19507,19812,20422,20565,20810,21209,21336,21641,21856,22069,22555])
#Z = interpolateP(Z_obs, P, P_obs)

newCAPE, t_parcel = getNewCAPE(T, Q, P, Z)

plotSkewT(T, Td, P, U, V, t_parcel, newCAPE, date = '2014061112')
